<Page x:Class="UnoApp3.Views.ProductListPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:UnoApp3.Views"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
      mc:Ignorable="d"
      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header với search và cart button -->
        <utu:NavigationBar Content="Danh sách sản phẩm"
                            Grid.Row="0">
            <utu:NavigationBar.MainContent>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox PlaceholderText="Tìm kiếm sản phẩm..."
                             Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Margin="0,0,12,0"/>
                    <Button Grid.Column="1"
                            Command="{Binding GoToCartCommand}"
                            ToolTipService.ToolTip="Giỏ hàng">
                        <SymbolIcon Symbol="ShoppingCart"/>
                    </Button>
                </Grid>
            </utu:NavigationBar.MainContent>
        </utu:NavigationBar>

        <!-- Tab lọc (Category/Supier - hiển thị như Pivot) -->
        <Pivot Grid.Row="1" Margin="0,10,0,0">
            <PivotItem Header="Tất cả">
                <Grid>
                    <!-- Product List với Refresh -->
                    <muxc:RefreshContainer
                        PullDirection="TopToBottom"
                        RefreshRequested="RefreshContainer_RefreshRequested">
                        <ListView ItemsSource="{Binding Products}"
                                  SelectionMode="None"
                                  IsItemClickEnabled="True"
                                  ItemClick="ListView_ItemClick">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="12"
                                          Background="Transparent">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Product Image -->
                                        <Border Width="80"
                                                Height="80"
                                                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                                CornerRadius="8">
                                            <Image Source="{Binding ImageUrl}"
                                                   Stretch="UniformToFill"/>
                                        </Border>

                                        <!-- Product Details -->
                                        <StackPanel Grid.Column="1"
                                                    Margin="12,0,12,0"
                                                    VerticalAlignment="Center">
                                            <TextBlock Text="{Binding ProductName}"
                                                       Style="{StaticResource BodyTextBlockStyle}"
                                                       FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding CategoryName}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            <TextBlock Text="{Binding Price, StringFormat='{}{0:C}'}"
                                                       Style="{StaticResource BodyTextBlockStyle}"
                                                       Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                                            <TextBlock Text="{Binding InventoryQuantity, StringFormat='Tồn kho: {0}'}"
                                                       Style="{StaticResource CaptionTextBlockStyle}"/>
                                        </StackPanel>

                                        <!-- Add to Cart Button -->
                                        <Button Grid.Column="2"
                                                Command="{Binding ElementName=PageRoot, Path=DataContext.AddToCartCommand}"
                                                CommandParameter="{Binding}"
                                                VerticalAlignment="Center">
                                            <SymbolIcon Symbol="Add"/>
                                        </Button>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </muxc:RefreshContainer>
                </Grid>
            </PivotItem>

            <!-- Có thể thêm các PivotItem khác cho category ở đây -->
            <PivotItem Header="Theo danh mục">
                <!-- Sẽ implement sau -->
            </PivotItem>
        </Pivot>

        <!-- Progress Ring khi đang tải -->
        <ProgressRing Grid.Row="1"
                      IsActive="{Binding IsBusy}"
                      Width="50"
                      Height="50"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"/>
    </Grid>
</Page>
