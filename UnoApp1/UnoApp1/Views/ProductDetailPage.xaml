<Page x:Class="UnoApp1.Views.ProductDetailPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:toolkit="using:Uno.Toolkit.WinUI"
      xmlns:ui="clr-namespace:Uno.Toolkit.UI;assembly=Uno.Toolkit.WinUI"
      xmlns:themes="clr-namespace:Uno.Themes;assembly=Uno.Themes.WinUI">

    <Grid ui:SafeArea.Insets="All"
          Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <ScrollViewer>
            <StackPanel Spacing="16" Padding="16">

                <!-- Product Image -->
                <Border Background="{ThemeResource PrimaryContainerBrush}"
                        Height="200"
                        CornerRadius="12"
                        HorizontalAlignment="Stretch">
                    <Viewbox>
                        <SymbolIcon Symbol="Shop"
                                    Foreground="{ThemeResource OnPrimaryContainerBrush}" />
                    </Viewbox>
                </Border>

                <!-- Product Info -->
                <StackPanel Spacing="12">
                    <TextBlock Text="{Binding Product.ProductName}"
                               FontSize="24"
                               FontWeight="Bold"
                               TextWrapping="Wrap" />

                    <TextBlock Text="{Binding Product.CategoryName}"
                               FontSize="16"
                               Foreground="{ThemeResource OnSurfaceVariantBrush}" />

                    <TextBlock
                        Text="{Binding Product.Price, Converter={StaticResource StringFormatConverter}, ConverterParameter='${0:F2}'}"
                        FontSize="28"
                        FontWeight="Bold"
                        Foreground="{ThemeResource PrimaryBrush}" />

                    <TextBlock
                        Text="{Binding Product.InventoryQuantity, Converter={StaticResource StringFormatConverter}, ConverterParameter='In Stock: {0}'}"
                        FontSize="14"
                        Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                </StackPanel>

                <!-- Quantity Selector -->
                <Border Background="{ThemeResource SurfaceVariantBrush}"
                        CornerRadius="8"
                        Padding="16">
                    <StackPanel>
                        <TextBlock Text="Quantity"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,12" />
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0"
                                       Text="{Binding Quantity}"
                                       FontSize="24"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center" />

                            <Button Grid.Column="1"
                                    Content="-"
                                    Command="{Binding DecreaseQuantityCommand}"
                                    Style="{StaticResource OutlinedButtonStyle}"
                                    Width="40"
                                    Height="40"
                                    Margin="0,0,8,0" />

                            <Button Grid.Column="2"
                                    Content="+"
                                    Command="{Binding IncreaseQuantityCommand}"
                                    Style="{StaticResource OutlinedButtonStyle}"
                                    Width="40"
                                    Height="40" />
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Cart Status -->
                <Border Background="{ThemeResource SecondaryContainerBrush}"
                        CornerRadius="8"
                        Padding="16"
                        Visibility="{Binding IsInCart, Converter={StaticResource TrueToVisibleConverter}}">
                    <TextBlock
                        Text="{Binding CartQuantity, Converter={StaticResource StringFormatConverter}, ConverterParameter='Already in cart: {0}'}"
                        Foreground="{ThemeResource OnSecondaryContainerBrush}"
                        TextAlignment="Center"
                        FontWeight="SemiBold" />
                </Border>

                <!-- Action Buttons -->
                <StackPanel Spacing="8" Margin="0,16,0,0">
                    <Button Content="Add to Cart"
                            Command="{Binding AddToCartCommand}"
                            Style="{StaticResource FilledButtonStyle}"
                            HorizontalAlignment="Stretch">
                        <themes:ControlExtensions.Icon>
                            <SymbolIcon Symbol="Add" />
                        </themes:ControlExtensions.Icon>
                    </Button>

                    <Button Content="View Cart"
                            Command="{Binding ViewCartCommand}"
                            Style="{StaticResource OutlinedButtonStyle}"
                            HorizontalAlignment="Stretch">
                        <themes:ControlExtensions.Icon>
                            <SymbolIcon Symbol="CalendarReply" />
                        </themes:ControlExtensions.Icon>
                    </Button>
                </StackPanel>

                <!-- Loading Indicator -->
                <ProgressRing IsActive="{Binding IsBusy}"
                              Visibility="{Binding IsBusy, Converter={StaticResource TrueToVisibleConverter}}"
                              HorizontalAlignment="Center" />
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
